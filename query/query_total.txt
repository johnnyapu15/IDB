--공통

--QUERY_0001
--물품을 검색
SELECT *
FROM PROD
WHERE (PROD_ID = :PROD_ID);

--QUERY_0050
----물품명을 이용해 물품 검색
SELECT *
FROM PROD
WHERE (PROD_NAME LIKE :PROD_NAME);


-------1.필요물품을 주문한다.
--0101에서 새 주문을, 0102에서 새 필요물품을 추가.

--QUERY_0101
-----주문에 추가
INSERT INTO ORD
(ORD_DAT, ORD_ID, BRANCH_ID)
VALUES (:ORD_DAT, SEQ_ORD.NEXTVAL, :BRANCH_ID);

--QUERY_0102
----필요물품에 추가
----KEY : ORD_ID, PROD_ID
INSERT INTO ORDERPROD
(ORD_DAT, ORD_ID, PROD_ID, ORD_REQUEST_QUANTITY, DEPOSIT_DAT, ORD_COST)
VALUES ((SELECT ORD_DAT 
         FROM ORD  
         WHERE (ORD_ID = :ORD_ID))
         , :ORD_ID, :PROD_ID, :ORD_REQUEST_QUANTITY, :DEPOSIT_DAT,
(:ORD_REQUEST_QUANTITY* 
(SELECT SELL_PRICE
FROM PROD
WHERE (PROD_ID = :PROD_ID))));


-------2.필요물품을 수정한다.
--

--QUERY_0201
----주문 엔티티 목록을 출력한다.
SELECT *
FROM ORD;

--QUERY_0202
----주문번호에 해당하는 필요물품을 출력한다.
SELECT *
FROM ORDERPROD
WHERE (ORD_ID = :ORD_ID);

--QUERY_0203
----필요물품을 수정한다.
--INPUT : 
--PROD ID 를 수정시 PROD_ID_MOD 로 입력
UPDATE ORDERPROD
SET (ORD_RESULT_QUANTITY = :ORD_RESULT_QUANTITY), 
(ORD_COST = (:ORD_RESULT_QUANTITY* 
(SELECT SELL_PRICE
FROM PROD
WHERE (PROD_ID = :PROD_ID))),
(DEPOSIT_DAT = :DEPOSIT_DAT)
WHERE (ORD_ID = :ORD_ID) AND (PROD_ID = :PROD_ID);

--QUERY_0204
----날짜 두개 사이에 있는 주문 목록을 출력
SELECT *
FROM ORD
WHERE ORD_DAT BETWEEN :START_DAY AND :END_DAY;


-------3.발주한 물품을 검토한다.
--QUERY_0201, 0202 여기서도 이용해야함.

--QUERY_0301
----수령 개수로 ORD COST 수정? -> 결산처리가 너무 복잡해짐.
----이때, 적절히 환불하는 프로세스가 이루어졌다고 가정한다.
UPDATE ORDPROD
SET ORD_RESULT_QUANTITY = :ORD_RESULT_QUANTITY, DEPOSIT_DAT = :DEPOSIT_DAT
WHERE (ORD_ID = :ORD_ID) AND (PROD_ID = :PROD_ID) AND (ORD_DAT = :ORD_DAT);


--QUERY_0302
----
SELECT * FROM WAREPROD WHERE PROD_ID=:PROD_ID AND MANUFACTURE_DAT = :MANUFACTURE_DAT

--QUERY_0303
----기존꺼에 더하기
UPDATE WAREPROD
  SET QUANTITY = QUANTITY + :QUANTITY
  WHERE PROD_ID = :PROD_ID AND MANUFACTURE_DAT = :MANUFACTURE_DAT;



--QUERY_0304
----새로 넣기
  INSERT INTO WAREPROD
  (QUANTITY, MANUFACTURE_DAT, PROD_ID, PROD_NAME, EXPIRATION_DAT)
  VALUES (:QUANTITY, :MANUFACTURE_DAT, :PROD_ID,
	(SELECT PROD_NAME
	 FROM PROD
	 WHERE PROD_ID = :PROD_ID),
  	 TO_DATE(:MANUFACTURE_DAT) + 
   (SELECT DISTRIB_PERIOD
	 FROM PROD
	 WHERE PROD_ID = :PROD_ID));




------4.발주를 취소한다.
--1. 주문 취소
--2. 필요물품 하나 삭제

--QUERY_0401
----한 주문을 취소한다. (CASCADING 규칙으로 필요물품도 삭제)
DELETE FROM ORD
WHERE (ORD_ID = :ORD_ID);

--QUERY_0402
----한 필요물품을 삭제한다.
DELETE FROM ORDERPROD
WHERE (ORD_ID = :ORD_ID) AND (PROD_ID = :PROD_ID);


------5.본사에 물품을 반품한다.
--1.반품물품 생성 2.진열/창고물품 수정

--QUERY_0501
----반품물품 생성
INSERT INTO RPROD
(PROD_ID, RETURN_ID, PROD_NAME, RETURN_REQUEST_QUANTITY, RETURN_CAUSE_CODE, RETURN_DAT, RETURN_PROCESS_RESULT)
VALUES (:PROD_ID, SEQ_RPROD.NEXTVAL,
        (SELECT PROD_NAME
         FROM PROD
         WHERE (PROD_ID = :PROD_ID),
         :RETURN_REQUEST_QUANTITY, :RETURN_CAUSE_CODE, : RETURN_DAT, :RETURN_PROCESS_RESULT);


--QUERY_0502
----진열물품 / 삭제
DELETE FROM DISPROD
WHERE (PROD_ID = :PROD_ID) AND (MANUFACTURE_DAT = :MANUFACTURE_DAT)

--QUERY_0503
----진열물품 / 수정
UPDATE DISPROD
SET DISPLAY_QUANTITY = :DISPLAY_QUANTITY
WHERE (PROD_ID = :PROD_ID) AND (MANUFACTURE_DAT = :MANUFACTURE_DAT)


--QUERY_0504
----창고물품/ 삭제
DELETE FROM WAREPROD
WHERE (PROD_ID = :PROD_ID) AND (MANUFACTURE_DAT = :MANUFACTURE_DAT)

--QUERY_0505
----창고물품 / 수정
UPDATE WAREPROD
          SET QUANTITY = :QUANTITY
          WHERE (PROD_ID = :PROD_ID) AND (MANUFACTURE_DAT = :MANUFACTURE_DAT)

-------6.유통기한이 지난 물품을 폐기한다.
--QUERY_0502, 0503 을 공용해서 진열/창고물품을 수정한다.

--QUERY_0601
----폐기물품에 추가
INSERT INTO DPROD
(PROD_ID, PROD_NAME, DISPOSE_PROCESS_DAT, QUANTITY)
VALUES (:PROD_ID, 
        SELECT PROD_NAME
        FROM PROD
        WHERE (PROD_ID = :PROD_ID),
        :DISPOSE_PROCESS_DAT, :QUANTITY);
        


-------7.진열된 물품을 판매한다.
--1.판매 생성 2.진열물품 수정


--QUERY_0701
----판매를 생성한다.
INSERT INTO SELL
(SELL_ID, PROD_ID, QUANTITY, SELL_COST)
VALUES (SEQ_SELL.NEXTVAL, :PROD_ID, :QUANTITY,
        :QUANTITY *
        SELECT SELL_PRICE
        FROM PROD
        WHERE (PROD_ID = :PROD_ID));

--QUERY_0702
----판매한 물품을 진열물품에서 수정한다.
CASE WHEN(:DISPLAY_QUANTITY = 0)
    THEN (DELETE FROM DISPROD
         WHERE (PROD_ID =:PROD_ID) AND (MANUFACTURE_DAT = :MANUFACTURE_DAT))
    ELSE (UPDATE DISPROD
         SET (DISPLAY_QUANTITY = :DISPLAY_QUANTITY)
         WHERE (PROD_ID = :PROD_ID) AND (MANUFACTURE_DAT = :MANUFACTURE_DAT))
END;



------8.판매한 물품을 판매취소한다.
--한 판매의 일부를 수정하고 싶으면 전부 취소후 다시 결제.

--QUERY_0801
----한 판매를 삭제한다.
DELETE FROM SELL
WHERE (SELL_ID = :SELL_ID);
